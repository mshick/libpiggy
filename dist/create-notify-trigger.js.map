{"version":3,"sources":["../src/create-notify-trigger.js"],"names":["createNotifyTrigger","client","key","query","text","then","results"],"mappings":";;;;;AAAA,MAAMA,sBAAsB,UAAU,EAACC,MAAD,EAASC,GAAT,EAAV,EAAyB;AACnD,SAAOD,OAAOE,KAAP,CAAa;AAClBC,UAAO;;;;;;qFAM0EF,GAAI;;;;;;AAPnE,GAAb,EAcNG,IAdM,CAcD,MAAMJ,OAAOE,KAAP,CAAc,iBAAd,CAdL,EAeNE,IAfM,CAeDC,WAAW;AACf,WAAO;AACLL,YADK;AAELK;AAFK,KAAP;AAID,GApBM,CAAP;AAqBD,CAtBD;;kBAwBeN,mB","file":"create-notify-trigger.js","sourcesContent":["const createNotifyTrigger = function ({client, key}) {\n  return client.query({\n    text: `\n      CREATE OR REPLACE FUNCTION notify_trigger()\n      RETURNS TRIGGER AS\n      $body$\n      DECLARE\n      BEGIN\n        PERFORM pg_notify('watchers', 'table=' || TG_TABLE_NAME || '&pkey=' || NEW.${key} );\n        RETURN NEW;\n      END;\n      $body$\n      LANGUAGE plpgsql;\n    `\n  })\n  .then(() => client.query(`LISTEN watchers`))\n  .then(results => {\n    return {\n      client,\n      results\n    };\n  });\n};\n\nexport default createNotifyTrigger;\n"]}