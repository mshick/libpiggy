{"version":3,"sources":["../src/create-store.js"],"names":["createStore","client","table","indexes","watch","resolve","reject","then","exists","columns","key","length","catch","error"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,cAAc,UAAU,EAACC,MAAD,EAASC,KAAT,EAAgBC,OAAhB,EAAyBC,KAAzB,EAAV,EAA2C;AAC7D,SAAO,sBAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,+BAAY,EAACL,MAAD,EAASC,KAAT,EAAZ,EACGK,IADH,CACQ,CAAC,EAACC,MAAD,EAAD,KAAc;AAClB,UAAI,CAACA,MAAL,EAAa;AACX,cAAMC,UAAU,iCAAhB;AACA,YAAIL,KAAJ,EAAW;AACT,iBAAO,kCAAmB,EAACH,MAAD,EAASC,KAAT,EAAgBO,OAAhB,EAAyBC,KAAK,KAA9B,EAAnB,CAAP;AACD;AACD,eAAO,2BAAY,EAACT,MAAD,EAASC,KAAT,EAAgBO,OAAhB,EAAZ,CAAP;AACD;AACF,KATH,EAUGF,IAVH,CAUQ,MAAM;AACV,UAAIJ,WAAWA,QAAQQ,MAAvB,EAA+B;AAC7B,eAAO,kCAAmB,EAACV,MAAD,EAASC,KAAT,EAAgBC,OAAhB,EAAnB,CAAP;AACD;AACF,KAdH,EAeGI,IAfH,CAeQ,MAAM;AACVF,cAAQ,EAACJ,MAAD,EAAR;AACD,KAjBH,EAkBGW,KAlBH,CAkBSC,SAAS;AACdP,aAAOO,KAAP;AACD,KApBH;AAqBD,GAtBM,CAAP;AAuBD,CAxBD;;kBA0Beb,W","file":"create-store.js","sourcesContent":["import createTable from './create-table';\nimport createWatchedTable from './create-watched-table';\nimport tableExists from './table-exists';\nimport createStoreIndexes from './create-store-indexes';\n\nconst createStore = function ({client, table, indexes, watch}) {\n  return new Promise((resolve, reject) => {\n    tableExists({client, table})\n      .then(({exists}) => {\n        if (!exists) {\n          const columns = 'key text primary key, val jsonb';\n          if (watch) {\n            return createWatchedTable({client, table, columns, key: 'key'});\n          }\n          return createTable({client, table, columns});\n        }\n      })\n      .then(() => {\n        if (indexes && indexes.length) {\n          return createStoreIndexes({client, table, indexes});\n        }\n      })\n      .then(() => {\n        resolve({client});\n      })\n      .catch(error => {\n        reject(error);\n      });\n  });\n};\n\nexport default createStore;\n"]}